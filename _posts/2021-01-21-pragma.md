---
layout: default
title:  "Pragma Autonoumous Transactions"
date:   2021-01-21 15:21:38 -0800
categories: pl/sql, database management
excerpt: "Within a single transaction, multiple procedures and/or functions (subprograms) can be invoked. However, when a function or procedure is marked as pragma autonomous, it becomes independent of the transaction that called it. Let's explore more."
---

Within a single transaction, multiple procedures and/or functions (subprograms) can be invoked. However, when a function or procedure is marked as pragma autonomous, it becomes independent of the transaction that called it.  That is, within the autonomous subprogram, you can commit or roll back changes without committing or rolling back changes in the transaction which called the subprogram. 
The explanation makes the pragma autonomous directive sounds like an abstract functionality but it does practical uses for auditing database updates. Let’s explore below.

Scenario:

We have a table with sensitive employee information such as wage information, overtime rates, SIN, etc. 
```SQL
```
Sure, we can limit groups/users that access to table through grant privileges but what about monitoring the updates made by privileged users? 
Well, one potential solution is to set up triggers that will fire for updates/insertions/deletions and send some information to an audit table. 
```SQL
CREATE TRIGGER table_update_trg
BEFORE INSERT OR UPDATE OR DELETE
ON table
FOR EACH ROW
BEGIN
INSERT INTO log_table();
END;
```
However, what happens if the user does a rollback after making changes to this sensitive? Well, unfortunately, we lose the audit information sent to the audit table. 
This is where a pragma autonomous subprogram can provide a solution.

```SQL
CREATE OR REPLACE PROCEDURE log_changes() 
AS
PRAGMA AUTONOMOUS_TRANSACTION
BEGIN
INSERT INTO log_Table ();
COMMIT;
END;
```
We mark the procedure as pragma autonomous_transaction right before ‘BEGIN’ – which signals that this subprogram’s routine is an independent transaction. Within the routine, we insert data into the log table. Because it’s a pragma procedure we can commit within this subprogram .

Now we can use this procedure in the trigger. 





